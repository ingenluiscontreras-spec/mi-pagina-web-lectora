async function buscar() {
    const query = document.getElementById('busqueda').value;
    const resultadosDiv = document.getElementById('resultados');
    const estadoDiv = document.getElementById('estado');

    if (!query) {
        estadoDiv.innerHTML = "<span class='error'>Escribe algo para buscar.</span>";
        return;
    }

    estadoDiv.innerHTML = "Buscando...";
    resultadosDiv.innerHTML = "";

    try {
        // CORRECCIÓN: La URL debe empezar con https:// y usar comillas invertidas ``
        const url = `www.googleapis.com{encodeURIComponent(query)}&key=${API_KEY}`;
        
        console.log("Consultando a:", url); // Esto te servirá para ver la ruta real en consola

        const response = await fetch(url);
        
        if (!response.ok) {
            throw new Error(`Error de servidor: ${response.status}`);
        }

        const data = await response.json();

        if (!data.items) {
            estadoDiv.innerHTML = "<span class='error'>No se encontraron libros.</span>";
            return;
        }

        estadoDiv.innerHTML = `<span class='success'>Se encontraron ${data.items.length} resultados:</span>`;

        data.items.forEach(libro => {
            const info = libro.volumeInfo;
            const portada = info.imageLinks ? info.imageLinks.thumbnail.replace('http:', 'https:') : 'via.placeholder.com';
            
            const div = document.createElement('div');
            div.className = 'libro';
            div.innerHTML = `
                <img src="${portada}" alt="Portada">
                <div class="info">
                    <h3>${info.title}</h3>
                    <p><strong>Autor:</strong> ${info.authors ? info.authors.join(', ') : 'Desconocido'}</p>
                    <p><strong>Año:</strong> ${info.publishedDate || 'N/A'}</p>
                    <a href="${info.infoLink}" target="_blank" style="color: #2563eb; text-decoration: none; font-size: 13px;">Más info →</a>
                </div>
            `;
            resultadosDiv.appendChild(div);
        });

    } catch (error) {
        console.error("Detalle del error:", error);
        estadoDiv.innerHTML = `<span class='error'>Error: ${error.message}. Asegúrate de que la URL en el código empiece con https://</span>`;
    }
}
